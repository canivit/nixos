{ config, ... }:
let
  cfg =
    if config.hidpi.enable then {
      builtinRes = "3840x2400";
      externalRes = "3840x2160";
    } else {

      builtinRes = "1920x1200";
      externalRes = "1920x1080";
    };
in
{
  services.autorandr = {
    enable = true;
    defaultTarget = "laptop";
    hooks.postswitch = {
      updatelock = "updatelock";
    };
    profiles = {
      laptop = {
        fingerprint = {
          eDP-1 = "00ffffffffffff0030e4aa0600000000f11e0104b5221578e3c068a75533b5241050570000000101010101010101010101010101010178e700a0f06045903020360058d71000001a000000fd00303c94943c010a202020202020000000fe004c4720446973706c61790a2020000000fe004c503136305551312d53504231013802030f00e3058000e6060501737342000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006a";
        };

        config = {
          eDP-1 = {
            enable = true;
            primary = true;
            position = "0x0";
            mode = cfg.builtinRes;
            rotate = "normal";
            rate = "60.00";
          };
          DP-1.enable = false;
          DP-2.enable = false;
          DP-3.enable = false;
          DP-4.enable = false;
          HDMI-1.enable = false;
        };
      };

      monitor = {
        fingerprint = {
          eDP-1 = "00ffffffffffff0030e4aa0600000000f11e0104b5221578e3c068a75533b5241050570000000101010101010101010101010101010178e700a0f06045903020360058d71000001a000000fd00303c94943c010a202020202020000000fe004c4720446973706c61790a2020000000fe004c503136305551312d53504231013802030f00e3058000e6060501737342000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006a";
          # DP-1 = "00ffffffffffff0010ac79424c5834411e210104b53c22783adf15ad5044ad250f5054a54b00d100d1c0b300a94081808100714fe1c04dd000a0f0703e803020350055502100001a000000ff00333343483750330a2020202020000000fc0044454c4c20553237323351450a000000fd0017560f8c36010a2020202020200147020317f14a101f20041312110302012309070783010000a36600a0f0701f803020350055502100001a565e00a0a0a029503020350055502100001a114400a080001f503020360055502100001abf1600a08038134030203a0055502100001a0000000000000000000000000000000000000000000000000000000000000000a9";

          DP-3 = "00ffffffffffff0010ac77424c5834411e210103803c2278eadf15ad5044ad250f5054a54b00d100d1c0b300a94081808100714fe1c031ce0046f0705a8020108a0055502100001e000000ff00333343483750330a2020202020000000fc0044454c4c20553237323351450a000000fd0017560f8c3c000a20202020202001ed02033af15100005f5e5d101f2005140413121103020123090707830100006d030c001000383c20006001020367d85dc401788003e20f03e200d5565e00a0a0a029503020350055502100001a114400a080001f503020360055502100001abf1600a08038134030203a0055502100001a000000000000000000000000000000cc";

          # HDMI-1 = "00ffffffffffff0010ac77424c5834411e210103803c2278eadf15ad5044ad250f5054a54b00d100d1c0b300a94081808100714fe1c008e80030f2705a80b0588a0055502100001e000000ff00333343483750330a2020202020000000fc0044454c4c20553237323351450a000000fd0017560f8c3c000a202020202020013802033af15161605f5e5d101f2005140413121103020123090707830100006d030c001000383c20006001020367d85dc401788003e20f03e200d5565e00a0a0a029503020350055502100001a114400a080001f503020360055502100001abf1600a08038134030203a0055502100001a0000000000000000000000000000000b";
        };

        config = {
          eDP-1 = {
            enable = true;
            primary = false;
            position = "0x0";
            mode = cfg.externalRes;
            rotate = "normal";
            rate = "60.00";
          };

          DP-3 = {
            enable = true;
            primary = true;
            position = "0x0";
            mode = cfg.externalRes;
            rotate = "normal";
            rate = "60.00";
          };

          DP-1.enable = false;
          DP-2.enable = false;
          DP-4.enable = false;
          HDMI-1.enable = false;
        };
      };
    };
  };
}
